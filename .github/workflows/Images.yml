name: Build Image Azure Virtual Desktop

on: workflow_dispatch

env:
  LOCATION: "westeurope"
  RG_NAME_IMAGE: "Rg-AVD-Images-00"
  IMAGE_TEMPLATE_Name: "wvd10ImageTemplate00"

jobs:

  Buid_Image_AVD:
    runs-on: windows-2019

    steps:  

      - name: Installation des modules PowerShell
        run: |
          'Az.ImageBuilder', 'Az.ManagedServiceIdentity' | ForEach-Object {Install-Module -Name $_ -AllowPrerelease -Force}          
          $currentAzContext = Get-AzContext
          $imageResourceGroup="${{ env.RG_NAME_IMAGE }}"
          $location="${{ env.LOCATION }}"
          $subscriptionID=$currentAzContext.Subscription.Id
          $imageTemplateName="${{ env.IMAGE_TEMPLATE_Name}}"
          $runOutputName="sigOutput"
          New-AzResourceGroup -Name $imageResourceGroup -Location $location