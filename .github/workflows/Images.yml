name: Build Image Azure Virtual Desktop

on: workflow_dispatch

env:
  #


jobs:

  Buid_Image_AVD:
    runs-on: windows-2019

    steps:

      - name: Log in with Azure
        uses: azure/login@v1
        with:
          creds: '${{ secrets.AZURE_CREDENTIALS }}'
          enable-AzPSSession: true

      - name: Recuperation du Repo
        uses: actions/checkout@v2  

      - name: Prerequis
        run: |
          Install-Module Az.Accounts -Force
          Import-Module Az.Accounts
          $currentAzContext = Get-AzContext
          $imageResourceGroup="wvdImageDemoRg"
          $location="westus2"
          $subscriptionID=$currentAzContext.Subscription.Id
          $imageTemplateName="wvd10ImageTemplate01"
          $runOutputName="sigOutput"
          New-AzResourceGroup -Name $imageResourceGroup -Location $location
