name: Build Image Azure Virtual Desktop

on: workflow_dispatch

env:
  LOCATION: "westeurope"
  RG_NAME_IMAGE: "wvdImageDemoRg"
  IMAGE_TEMPLATE_Name: "wvd10ImageTemplate01"

jobs:

  Buid_Image_AVD:
    runs-on: windows-2019

    steps:

      - name: Log in with Azure
        uses: azure/login@v1
        with:
          creds: '${{ secrets.AZURE_CREDENTIALS }}'
          enable-AzPSSession: true

      - name: Recuperation du Repo
        uses: actions/checkout@v2  

      - name: Prerequis
        uses: azure/powershell@v1
        with:
          inlineScript: |
            #Install-Module Az.Accounts -Force
            #Import-Module Az.Accounts             
            $currentAzContext = Get-AzContext
            $imageResourceGroup=${{ env.RG_NAME_IMAGE }}
            $location=${{ env.LOCATION }}
            $subscriptionID=$currentAzContext.Subscription.Id
            $imageTemplateName=${{ env.IMAGE_TEMPLATE_Name}}
            $runOutputName="sigOutput"
            New-AzResourceGroup -Name "toto-rg" -Location $location          
          azPSVersion: 'latest'